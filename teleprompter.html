<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Teleprompter Pro</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  background: black;
  color: #f5f5f5;
  font-family: Arial, Helvetica, sans-serif;
  overflow: hidden;
}

#container {
  position: relative;
}

#text {
  font-size: 64px;
  line-height: 1.5;
  padding: 14vh 12vw;
  white-space: pre-wrap;
  transform-origin: center;
}

.mirror {
  transform: scaleX(-1);
}

#guide {
  position: fixed;
  top: 50%;
  left: 0;
  right: 0;
  height: 2px;
  background: rgba(255,255,255,0.25);
  pointer-events: none;
}

.camera #guide {
  display: block;
}
</style>
</head>

<body>

<div id="container">
  <div id="text" class="mirror">Esperando texto…</div>
  <div id="guide"></div>
</div>

<script>
const WS_URL = "wss://teleprompter-ws-5ziy.onrender.com";
const PIN = "1234";

const socket = new WebSocket(WS_URL);
const textEl = document.getElementById("text");

let scrollSpeed = 0;
let yPos = 0;
let lastTime = null;
let totalHeight = 0;

/* Recepción */
socket.onmessage = e => {
  const data = JSON.parse(e.data);
  if (data.pin !== PIN) return;

  if (data.action === "text") {
    textEl.innerText = data.value || "";
    yPos = 0;
    window.scrollTo(0, 0);
    setTimeout(() => {
      totalHeight = document.body.scrollHeight;
    }, 100);
  }

  if (data.action === "speed") {
    scrollSpeed = Number(data.value) || 0;
  }

  if (data.action === "camera") {
    document.body.classList.toggle("camera");
    textEl.classList.toggle("mirror");
  }
};

/* Scroll + estado */
function animate(t) {
  if (!lastTime) lastTime = t;
  const delta = t - lastTime;
  lastTime = t;

  yPos += scrollSpeed * delta * 0.06;
  window.scrollTo(0, yPos);

  // Enviar estado al control
  socket.send(JSON.stringify({
    action: "status",
    pin: PIN,
    y: yPos,
    total: totalHeight,
    speed: scrollSpeed
  }));

  requestAnimationFrame(animate);
}

requestAnimationFrame(animate);
</script>

</body>
</html>

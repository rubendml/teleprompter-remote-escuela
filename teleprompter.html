<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Teleprompter Pro</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  background: black;
  color: white;
  font-family: Arial, Helvetica, sans-serif;
  overflow: hidden;
}

/* Contenedor principal */
#container {
  position: relative;
}

/* Texto */
#text {
  font-size: 64px;
  line-height: 1.4;
  padding: 12vh 10vw;
  white-space: pre-wrap;
  transform-origin: center;
}

/* Espejo */
.mirror {
  transform: scaleX(-1);
}

/* LÃ­nea guÃ­a */
#guide {
  position: fixed;
  top: 50%;
  left: 0;
  right: 0;
  height: 2px;
  background: rgba(255, 255, 255, 0.25);
  pointer-events: none;
  display: none;
}
</style>
</head>

<body>

<div id="container">
  <div id="text" class="mirror">Esperando textoâ€¦</div>
  <div id="guide"></div>
</div>

<script>
/* ===============================
   CONFIGURACIÃ“N
================================ */
const WS_URL = "wss://teleprompter-ws-5ziy.onrender.com";

/* ===============================
   VARIABLES
================================ */
const socket = new WebSocket(WS_URL);
const textEl = document.getElementById("text");
const guideEl = document.getElementById("guide");

let scrollSpeed = 0;
let yPos = 0;
let mirrorEnabled = true;
let guideEnabled = false;
let lastFrameTime = null;

/* ===============================
   WEBSOCKET
================================ */
socket.onopen = () => {
  console.log("ðŸŸ¢ Teleprompter conectado al servidor");
};

socket.onerror = (err) => {
  console.error("ðŸ”´ Error WebSocket:", err);
};

socket.onclose = () => {
  console.warn("âš ï¸ ConexiÃ³n WebSocket cerrada");
};

socket.onmessage = (event) => {
  const data = JSON.parse(event.data);
  console.log("ðŸ“© Mensaje recibido:", data);

  switch (data.action) {

    case "text":
      textEl.innerText = data.value || "";
      yPos = 0;
      window.scrollTo(0, 0);
      break;

    case "speed":
      scrollSpeed = Number(data.value) || 0;
      break;

    case "mirror":
      mirrorEnabled = !mirrorEnabled;
      textEl.classList.toggle("mirror", mirrorEnabled);
      break;

    case "guide":
      guideEnabled = !guideEnabled;
      guideEl.style.display = guideEnabled ? "block" : "none";
      break;

    case "font":
      textEl.style.fontSize = data.value + "px";
      break;
  }
};

/* ===============================
   SCROLL SUAVE (PRO)
================================ */
function animateScroll(timestamp) {
  if (!lastFrameTime) lastFrameTime = timestamp;
  const delta = timestamp - lastFrameTime;
  lastFrameTime = timestamp;

  yPos += scrollSpeed * delta * 0.06;
  window.scrollTo(0, yPos);

  requestAnimationFrame(animateScroll);
}

requestAnimationFrame(animateScroll);
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Teleprompter Pro</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  background: black;
  color: #f5f5f5;
  font-family: Arial, Helvetica, sans-serif;
  overflow: hidden;
}

/* Contenedor */
#container {
  position: relative;
}

/* Texto principal */
#text {
  font-size: 64px;
  line-height: 1.5;
  padding: 14vh 12vw;
  white-space: pre-wrap;
  transform-origin: center;
}

/* Espejo */
.mirror {
  transform: scaleX(-1);
}

/* L√≠nea gu√≠a */
#guide {
  position: fixed;
  top: 50%;
  left: 0;
  right: 0;
  height: 2px;
  background: rgba(255,255,255,0.25);
  pointer-events: none;
  display: none;
}

/* Modo c√°mara */
.camera #guide {
  display: block;
}
</style>
</head>

<body>

<div id="container">
  <div id="text" class="mirror">Esperando texto‚Ä¶</div>
  <div id="guide"></div>
</div>

<script>
/* ===============================
   CONFIGURACI√ìN
================================ */
const WS_URL = "wss://teleprompter-ws-5ziy.onrender.com";
const PIN = "1234";

/* ===============================
   VARIABLES
================================ */
const socket = new WebSocket(WS_URL);
const textEl = document.getElementById("text");

let scrollSpeed = 0;
let yPos = 0;
let lastTime = null;
let totalHeight = 0;
let socketReady = false;

/* ===============================
   WEBSOCKET
================================ */
socket.onopen = () => {
  socketReady = true;
  console.log("üü¢ Teleprompter conectado (env√≠o habilitado)");
};

socket.onerror = (err) => {
  console.error("üî¥ Error WebSocket:", err);
};

socket.onclose = () => {
  socketReady = false;
  console.warn("‚ö†Ô∏è WebSocket cerrado");
};

socket.onmessage = (event) => {
  const data = JSON.parse(event.data);
  if (data.pin !== PIN) return;

  switch (data.action) {

    case "text":
      textEl.innerText = data.value || "";
      yPos = 0;
      window.scrollTo(0, 0);
      setTimeout(() => {
        totalHeight = document.body.scrollHeight;
      }, 100);
      break;

    case "speed":
      scrollSpeed = Number(data.value) || 0;
      break;

    case "camera":
      document.body.classList.toggle("camera");
      textEl.classList.toggle("mirror");
      break;
  }
};

/* ===============================
   SCROLL ULTRA SUAVE + ESTADO
================================ */
function animate(timestamp) {
  if (!lastTime) lastTime = timestamp;
  const delta = timestamp - lastTime;
  lastTime = timestamp;

  yPos += scrollSpeed * delta * 0.06;
  window.scrollTo(0, yPos);

  /* Enviar estado SOLO si el socket est√° listo */
  if (socketReady && totalHeight > 0) {
    socket.send(JSON.stringify({
      action: "status",
      pin: PIN,
      y: yPos,
      total: totalHeight,
      speed: scrollSpeed
    }));
  }

  requestAnimationFrame(animate);
}

requestAnimationFrame(animate);
</script>

</body>
</html>

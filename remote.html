<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Control Teleprompter</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  background: #111;
  color: white;
  font-family: Arial, sans-serif;
  padding: 15px;
}

textarea, select {
  width: 100%;
  margin-bottom: 10px;
  font-size: 16px;
}

button {
  width: 100%;
  padding: 14px;
  margin-bottom: 8px;
  font-size: 18px;
  border: none;
  border-radius: 8px;
}

.play { background: #2ecc71; }
.pause { background: #e74c3c; }
.blue { background: #3498db; }
.purple { background: #9b59b6; }
.orange { background: #f39c12; }
.green { background: #1abc9c; }
</style>
</head>

<body>

<h2>ğŸ® Control Teleprompter</h2>

<select id="savedTexts" onchange="loadSaved()">
  <option value="">ğŸ“‚ Textos guardados</option>
</select>

<textarea id="script" rows="8" placeholder="Escribe o pega el texto aquÃ­..."></textarea>

<button class="green" onclick="sendText()">ğŸ“¤ Enviar texto</button>
<button class="blue" onclick="saveText()">ğŸ’¾ Guardar texto</button>
<button class="orange" onclick="toggleMirror()">ğŸ” Espejo ON / OFF</button>

<button class="play" onclick="send('play')">â–¶ Play</button>
<button class="pause" onclick="send('pause')">â¸ Pausa</button>

<button class="purple" onclick="changeSpeed(1)">â• Velocidad</button>
<button class="purple" onclick="changeSpeed(-1)">â– Velocidad</button>

<button class="blue" onclick="send('up')">â¬† Subir</button>
<button class="blue" onclick="send('down')">â¬‡ Bajar</button>

<script>
const socket = new WebSocket("wss://teleprompter-ws-5ziy.onrender.com");

let speed = 1;
let texts = JSON.parse(localStorage.getItem("teleprompterTexts")) || [];

const select = document.getElementById("savedTexts");
const textarea = document.getElementById("script");

function refreshList() {
  select.innerHTML = '<option value="">ğŸ“‚ Textos guardados</option>';
  texts.forEach((t, i) => {
    const option = document.createElement("option");
    option.value = i;
    option.textContent = t.title;
    select.appendChild(option);
  });
}

function send(action, value = null) {
  socket.send(JSON.stringify({ action, value }));
}

function sendText() {
  send("text", textarea.value);
}

function toggleMirror() {
  send("mirror");
}

function changeSpeed(delta) {
  speed = Math.max(0, speed + delta);
  send("speed", speed);
}

function saveText() {
  const title = prompt("Nombre del texto:");
  if (!title) return;

  texts.push({ title, content: textarea.value });
  localStorage.setItem("teleprompterTexts", JSON.stringify(texts));
  refreshList();
}

function loadSaved() {
  const index = select.value;
  if (index === "") return;
  textarea.value = texts[index].content;
}

refreshList();
</script>

</body>
</html>

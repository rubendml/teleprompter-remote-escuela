<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Control Teleprompter</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  background: #111;
  color: white;
  font-family: Arial, sans-serif;
  padding: 15px;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}

/* Logo */
#logo {
  text-align: center;
  margin-bottom: 10px;
}

#logo img {
  max-width: 180px;
  width: 60%;
  height: auto;
}

/* Contenido */
#content {
  flex: 1;
}

textarea, input[type=file] {
  width: 100%;
  margin-bottom: 10px;
  font-size: 16px;
}

button {
  width: 100%;
  padding: 14px;
  margin-bottom: 8px;
  font-size: 18px;
  border: none;
  border-radius: 8px;
}

.green { background: #1abc9c; }
.blue { background: #3498db; }
.orange { background: #f39c12; }
.purple { background: #9b59b6; }

/* Pie */
footer {
  text-align: center;
  font-size: 13px;
  color: #aaa;
  margin-top: 10px;
}
</style>
</head>

<body>

<div id="logo">
  <img src="logo-escuela.svg" alt="Logo">
</div>

<div id="content">

<input type="file" accept=".txt,.md,.docx" onchange="loadFile(event)">

<textarea id="script" rows="7" placeholder="Texto del teleprompterâ€¦"></textarea>

<button class="green" onclick="sendText()">ðŸ“¤ Enviar texto</button>
<button class="orange" onclick="toggleCamera()">ðŸŽ¥ Modo CÃ¡mara</button>

<button class="purple" onclick="changeSpeed(0.5)">âž• Velocidad</button>
<button class="purple" onclick="changeSpeed(-0.5)">âž– Velocidad</button>

</div>

<footer>
  Creaciones Manotas
</footer>

<script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>

<script>
const socket = new WebSocket("wss://teleprompter-ws-5ziy.onrender.com");
let speed = 0;

function send(action, value = null) {
  if (socket.readyState === WebSocket.OPEN) {
    socket.send(JSON.stringify({ action, value }));
  }
}

function sendText() {
  send("text", document.getElementById("script").value);
}

function toggleCamera() {
  send("camera");
}

function changeSpeed(delta) {
  speed = Math.max(0, speed + delta);
  send("speed", speed);
}

function loadFile(event) {
  const file = event.target.files[0];
  if (!file) return;

  const ext = file.name.split(".").pop().toLowerCase();

  if (ext === "docx") {
    const reader = new FileReader();
    reader.onload = e => {
      mammoth.extractRawText({ arrayBuffer: e.target.result })
        .then(res => document.getElementById("script").value = res.value);
    };
    reader.readAsArrayBuffer(file);
  }

  if (ext === "txt" || ext === "md") {
    const reader = new FileReader();
    reader.onload = e => document.getElementById("script").value = e.target.result;
    reader.readAsText(file);
  }
}
</script>

</body>
</html>
